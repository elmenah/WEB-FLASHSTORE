import"./modulepreload-polyfill-B5Qt9EMX.js";let d=JSON.parse(localStorage.getItem("carrito"))||[];const q=document.getElementById("cart-desktop"),F=document.getElementById("cart-mobile"),y=document.getElementById("carrito-popup"),V=document.getElementById("cerrar-carrito");q.addEventListener("click",()=>{y.classList.add("open"),b()});F.addEventListener("click",()=>{y.classList.add("open"),b()});V.addEventListener("click",()=>{y.classList.remove("open")});function b(){const t=document.getElementById("carrito-contenido");t.innerHTML="",d.length===0&&(t.innerHTML="<p>No hay productos en el carrito.</p>");let s=0;d.forEach((a,o)=>{const m=document.createElement("div");m.classList.add("carrito-item"),m.innerHTML=`
            <img src="${a.imagen}" alt="${a.nombre}">
            <div class="nombre">${a.nombre}</div>
            <div class="precio">${a.precio.toLocaleString("es-CL")} CLP</div>
            <div class="eliminar" data-index="${o}">❌</div>
        `,t.appendChild(m),s+=a.precio}),document.getElementById("total-precio").textContent=s.toLocaleString("es-CL"),document.querySelectorAll(".carrito-item .eliminar").forEach(a=>{a.addEventListener("click",o=>{const m=o.target.getAttribute("data-index");d.splice(m,1),localStorage.setItem("carrito",JSON.stringify(d)),b()})})}document.getElementById("vaciar-carrito").addEventListener("click",()=>{d=[],localStorage.setItem("carrito",JSON.stringify(d)),b()});function J(t){d.push(t),localStorage.setItem("carrito",JSON.stringify(d)),b()}document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("hamburguer-menu"),s=document.getElementById("close-menu"),r=document.getElementById("hamburguer-menu-list");t.addEventListener("click",function(){r.classList.remove("hidden")}),s.addEventListener("click",function(){r.classList.add("hidden")}),r.addEventListener("click",function(a){a.target===r&&r.classList.add("hidden")})});function Y(){const t=document.getElementById("notificacion-carrito");t.classList.remove("hidden"),t.classList.add("opacity-100"),setTimeout(()=>{t.classList.add("hidden"),t.classList.remove("opacity-100")},2e3)}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("productos");async function s(){try{const a=await fetch("https://fortniteapi.io/v2/shop?lang=es-419&includeRenderData=false",{headers:{Authorization:"11b1a0cd-5fdf5d92-62c4e04b-7356366c"}});if(!a.ok)throw new Error("Error al obtener los datos de la API");const o=await a.json();r(o.shop)}catch(a){console.error("❌ Error al cargar la API:",a)}}function r(a){t.innerHTML="";let o={};a.forEach(n=>{var L,h,C,c,g,f,E,I,v,$,S,k,B,R,U,D,O,P,w,A,H,M,N,T,z,j,x;let p=n.displayType||"No especificado";const l=((L=n.section)==null?void 0:L.name)||p;o[l]||(o[l]=[]);const u=new Date((h=n.offerDates)==null?void 0:h.out),e=new Date;let i="";if(u<=e)i="Este producto está fuera de oferta";else{const _=Math.ceil((u-e)/864e5);_<=2&&(i=`¡Últimas horas! Sale en ${_} día(s)`)}o[l].push({nombre:n.displayName,precio:n.price.finalPrice,imagen:(C=n.displayAssets)!=null&&C.length?n.displayAssets[0].background||n.displayAssets[0].url:(f=(g=(c=n.granted)==null?void 0:c[0])==null?void 0:g.images)==null?void 0:f.icon_background,descripcion:n.displayDescription||n.description||"Sin descripción disponible",grupo:((E=n.series)==null?void 0:E.name)||((I=n.set)==null?void 0:I.name)||"Sin categoría",tipo:p,descuento:((v=n.banner)==null?void 0:v.name)||null,inicio:(($=n.offerDates)==null?void 0:$.in)||null,fin:((S=n.offerDates)==null?void 0:S.out)||null,mensajeSalida:i,partede:((R=(B=(k=n.granted)==null?void 0:k[0])==null?void 0:B.set)==null?void 0:R.partOf)||"",bundle:(O=(D=(U=n.granted)==null?void 0:U[0])==null?void 0:D.images)==null?void 0:O.icon_background,bundle2:(A=(w=(P=n.granted)==null?void 0:P[1])==null?void 0:w.images)==null?void 0:A.icon_background,bundle3:(N=(M=(H=n.granted)==null?void 0:H[2])==null?void 0:M.images)==null?void 0:N.icon_background,bundle4:(j=(z=(T=n.granted)==null?void 0:T[3])==null?void 0:z.images)==null?void 0:j.icon_background,rareza:((x=n.rarity)==null?void 0:x.name)||"Sin rareza"})}),Object.entries(o).sort(([n],[p])=>n==="Pistas de improvisación"?1:p==="Pistas de improvisación"?-1:0).forEach(([n,p])=>{const l=document.createElement("h2");l.textContent=n,l.className="category-title",t.appendChild(l);const u=document.createElement("div");u.className=n==="Pistas de improvisación"?"pistas-container":"product-container",p.slice(0,20).forEach(e=>{const i=document.createElement("div");i.classList.add("product-card"),e.tipo==="bundle"&&i.classList.add("big-product-card");const L=e.rareza,h=e.partede||"",C=h.substr(18);i.innerHTML=`
                  ${e.descuento?`<div class="discount-banner">${e.descuento}</div>`:""}
                  <img src="${e.imagen}" alt="${e.nombre}">
                  
                  <div class="product-info">
                      <h3>${e.nombre}</h3>
                       <p><strong>Rareza:</strong> ${L}</p>
                       <p><strong></strong> ${h}</p>
                      <div class="price">
                          <img src="https://lh3.googleusercontent.com/d/1VGnO_T1S2sH-IqqD8TX6aHyQKD7rEYzH=s220?authuser=0" alt="V-Bucks">
                          <span class="old-price">${e.precio}</span>
                          <span class="new-price">${(e.precio*4.9).toLocaleString("es-CL")} CLP</span>
                      </div>
                  </div>
                  <button class="carrito" data-product="${e.nombre}" data-price="${e.precio}" data-imagen="${e.imagen}" data-fecha="${e.fin}">
                      <img src="https://lh3.googleusercontent.com/d/1G3MVAV9knIYqiLI6cI7gwKob6Vuvo5MC=s220?authuser=0" alt="Añadir al carrito">
                  </button>
                  
              `,i.querySelector(".carrito").addEventListener("click",c=>{c.stopPropagation();const g=c.target.closest("button").dataset.product,f=c.target.closest("button").dataset.price*4.9,E=c.target.closest("button").dataset.imagen;J({nombre:g,precio:f,imagen:E}),Y()}),i.addEventListener("click",c=>{if(!c.target.closest(".carrito")){const g=e.descripcion||"Sin descripción disponible",f=e.fin||"Fecha no disponible";window.location.href=`detalleproducto.html?nombre=${encodeURIComponent(e.nombre)}&precio=${encodeURIComponent(e.precio)}&imagen=${encodeURIComponent(e.imagen)}&partOf=${encodeURIComponent(e.grupo)}&mainType=${encodeURIComponent(e.tipo)}&descripcion=${encodeURIComponent(g)}&fecha=${encodeURIComponent(e.inicio||"Fecha no disponible.")}&out=${encodeURIComponent(f)}&mensajeSalida=${encodeURIComponent(e.mensajeSalida)}&rareza=${encodeURIComponent(e.rareza)}&partede=${encodeURIComponent(C)}&imgbundle=${encodeURIComponent(e.bundle)}&imgbundle2=${encodeURIComponent(e.bundle2)}&imgbundle3=${encodeURIComponent(e.bundle3)}&imgbundle4=${encodeURIComponent(e.bundle4)}
            
            `}}),u.appendChild(i)}),t.appendChild(u)})}s()});function G(){const t=new Date,s={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0};return t.toLocaleString("es-ES",s)}document.getElementById("fecha-actual").textContent=G();
