import"./modulepreload-polyfill-3cfb730f.js";let p=JSON.parse(localStorage.getItem("carrito"))||[];const j=document.getElementById("cart-desktop"),F=document.getElementById("cart-mobile"),I=document.getElementById("carrito-popup"),V=document.getElementById("cerrar-carrito");j.addEventListener("click",()=>{I.classList.add("open"),b()});F.addEventListener("click",()=>{I.classList.add("open"),b()});V.addEventListener("click",()=>{I.classList.remove("open")});function b(){const n=document.getElementById("carrito-contenido");n.innerHTML="",p.length===0&&(n.innerHTML="<p>No hay productos en el carrito.</p>");let c=0;p.forEach((a,i)=>{const r=document.createElement("div");r.classList.add("carrito-item"),r.innerHTML=`
            <img src="${a.imagen}" alt="${a.nombre}">
            <div class="nombre">${a.nombre}</div>
            <div class="precio">${a.precio.toLocaleString("es-CL")} CLP</div>
            <div class="eliminar" data-index="${i}">❌</div>
        `,n.appendChild(r),c+=a.precio}),document.getElementById("total-precio").textContent=c.toLocaleString("es-CL"),document.querySelectorAll(".carrito-item .eliminar").forEach(a=>{a.addEventListener("click",i=>{const r=i.target.getAttribute("data-index");p.splice(r,1),localStorage.setItem("carrito",JSON.stringify(p)),b()})})}document.getElementById("vaciar-carrito").addEventListener("click",()=>{p=[],localStorage.setItem("carrito",JSON.stringify(p)),b()});document.querySelector("#carrito-popup .checkout-btn").addEventListener("click",()=>{window.location.href="/checkout.html"});function _(n){p.push(n),localStorage.setItem("carrito",JSON.stringify(p)),b()}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("hamburguer-menu"),c=document.getElementById("close-menu"),o=document.getElementById("hamburguer-menu-list");n.addEventListener("click",function(){o.classList.remove("hidden")}),c.addEventListener("click",function(){o.classList.add("hidden")}),o.addEventListener("click",function(a){a.target===o&&o.classList.add("hidden")})});function J(){const n=document.getElementById("notificacion-carrito");n.classList.remove("hidden"),n.classList.add("opacity-100"),setTimeout(()=>{n.classList.add("hidden"),n.classList.remove("opacity-100")},2e3)}document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("productos");let c=[];async function o(){try{const i=await fetch("https://fortniteapi.io/v2/shop?lang=es-419&includeRenderData=false",{headers:{Authorization:"11b1a0cd-5fdf5d92-62c4e04b-7356366c"}});if(!i.ok)throw new Error("Error al obtener los datos de la API");c=(await i.json()).shop,a(c)}catch(i){console.error("❌ Error al cargar la API:",i)}}function a(i){n.innerHTML="";let r={};i.forEach(t=>{var L,h,C,u,g,f,y,E,$,S,k,B,w,R,P,U,D,O,N,z,H,M,T,A,q;let l=t.displayType||"No especificado";const s=((L=t.section)==null?void 0:L.name)||l||"Otros";r[s]||(r[s]=[]);const m=new Date((h=t.offerDates)==null?void 0:h.out),e=new Date;let d="";if(m<=e)d="Este producto está fuera de oferta";else{const x=Math.ceil((m-e)/864e5);x<=2&&(d=`¡Últimas horas! Sale en ${x} día(s)`)}r[s].push({nombre:t.displayName,precio:t.price.finalPrice,imagen:(u=(C=t.displayAssets)==null?void 0:C[0])==null?void 0:u.url,descripcion:t.displayDescription||t.description||"Sin descripción disponible",grupo:((g=t.series)==null?void 0:g.name)||((f=t.set)==null?void 0:f.name)||"Sin categoría",tipo:l,descuento:((y=t.banner)==null?void 0:y.name)||null,inicio:((E=t.offerDates)==null?void 0:E.in)||null,fin:(($=t.offerDates)==null?void 0:$.out)||null,mensajeSalida:d,partede:((B=(k=(S=t.granted)==null?void 0:S[0])==null?void 0:k.set)==null?void 0:B.partOf)||"",bundle:(P=(R=(w=t.granted)==null?void 0:w[0])==null?void 0:R.images)==null?void 0:P.icon_background,bundle2:(O=(D=(U=t.granted)==null?void 0:U[1])==null?void 0:D.images)==null?void 0:O.icon_background,bundle3:(H=(z=(N=t.granted)==null?void 0:N[2])==null?void 0:z.images)==null?void 0:H.icon_background,bundle4:(A=(T=(M=t.granted)==null?void 0:M[3])==null?void 0:T.images)==null?void 0:A.icon_background,colorfondo:t.colors.color1,rareza:((q=t.rarity)==null?void 0:q.name)||"Sin rareza"})}),Object.entries(r).sort(([t],[l])=>t==="Pistas de improvisación"?1:l==="Pistas de improvisación"?-1:0).forEach(([t,l])=>{const s=document.createElement("h2");s.textContent=t,s.className="category-title",n.appendChild(s);const m=document.createElement("div");m.className=t==="Pistas de improvisación"?"pistas-container":"product-container",l.slice(0,20).forEach(e=>{const d=document.createElement("div");d.classList.add("product-card"),e.tipo==="bundle"&&d.classList.add("big-product-card");const L=e.rareza,h=e.partede||"",C=h.substr(18);d.innerHTML=`
  ${e.descuento?`<div class="discount-banner">${e.descuento}</div>`:""}
  <div class="product-image" style="background-color: ${e.colorfondo};">
    <img src="${e.imagen}" alt="${e.nombre}">
  </div>
  <div class="product-info">
      <h3>${e.nombre}</h3>
      <p><strong>Rareza:</strong> ${L}</p>
      <p><strong></strong> ${h}</p>
      <div class="price">
          <img src="https://lh3.googleusercontent.com/d/1VGnO_T1S2sH-IqqD8TX6aHyQKD7rEYzH=s220?authuser=0" alt="V-Bucks" style="width: 20px;">
          <span class="old-price">${e.precio}</span>
          <span class="new-price">${(e.precio*4.4).toLocaleString("es-CL")} CLP</span>
      </div>
  </div>
  <button class="carrito" data-product="${e.nombre}" data-price="${e.precio}" data-imagen="${e.imagen}" data-fecha="${e.fin}">
      <img src="https://lh3.googleusercontent.com/d/1G3MVAV9knIYqiLI6cI7gwKob6Vuvo5MC=s220?authuser=0" alt="Añadir al carrito">
  </button>
`,d.querySelector(".carrito").addEventListener("click",u=>{u.stopPropagation();const g=u.target.closest("button").dataset.product,f=u.target.closest("button").dataset.price*4.9,y=u.target.closest("button").dataset.imagen;_({nombre:g,precio:f,imagen:y}),J()}),d.addEventListener("click",u=>{if(!u.target.closest(".carrito")){const g=e.descripcion||"Sin descripción disponible",f=e.fin||"Fecha no disponible";window.location.href=`detalleproducto.html?nombre=${encodeURIComponent(e.nombre)}&precio=${encodeURIComponent(e.precio)}&imagen=${encodeURIComponent(e.imagen)}&partOf=${encodeURIComponent(e.grupo)}&mainType=${encodeURIComponent(e.tipo)}&descripcion=${encodeURIComponent(g)}&fecha=${encodeURIComponent(e.inicio||"Fecha no disponible.")}&out=${encodeURIComponent(f)}&mensajeSalida=${encodeURIComponent(e.mensajeSalida)}&rareza=${encodeURIComponent(e.rareza)}&partede=${encodeURIComponent(C)}&imgbundle=${encodeURIComponent(e.bundle)}&imgbundle2=${encodeURIComponent(e.bundle2)}&imgbundle3=${encodeURIComponent(e.bundle3)}&imgbundle4=${encodeURIComponent(e.bundle4)}
            
            `}}),m.appendChild(d)}),n.appendChild(m)})}o()});function Y(){const n=new Date,c={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0};return n.toLocaleString("es-ES",c)}document.getElementById("fecha-actual").textContent=Y();document.querySelector("#carrito-popup .total button").addEventListener("click",()=>{window.location.href="checkout.html"});document.getElementById("buscador").addEventListener("input",function(){const n=this.value.toLowerCase().trim();if(!n){mostrarProductos(allItems);return}const c=allItems.filter(o=>{var t,l,s,m;const a=(o.displayName||"").toLowerCase(),i=(((t=o.rarity)==null?void 0:t.name)||"").toLowerCase(),r=(((l=o.series)==null?void 0:l.name)||((s=o.set)==null?void 0:s.name)||"").toLowerCase(),v=(((m=o.section)==null?void 0:m.name)||"").toLowerCase();return a.includes(n)||i.includes(n)||r.includes(n)||v.includes(n)});mostrarProductos(c)});
