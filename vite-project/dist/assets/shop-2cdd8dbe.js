import"./modulepreload-polyfill-3cfb730f.js";let d=JSON.parse(localStorage.getItem("carrito"))||[];const _=document.getElementById("cart-desktop"),F=document.getElementById("cart-mobile"),I=document.getElementById("carrito-popup"),V=document.getElementById("cerrar-carrito");_.addEventListener("click",()=>{I.classList.add("open"),b()});F.addEventListener("click",()=>{I.classList.add("open"),b()});V.addEventListener("click",()=>{I.classList.remove("open")});function b(){const n=document.getElementById("carrito-contenido");n.innerHTML="",d.length===0&&(n.innerHTML="<p>No hay productos en el carrito.</p>");let s=0;d.forEach((a,o)=>{const m=document.createElement("div");m.classList.add("carrito-item"),m.innerHTML=`
            <img src="${a.imagen}" alt="${a.nombre}">
            <div class="nombre">${a.nombre}</div>
            <div class="precio">${a.precio.toLocaleString("es-CL")} CLP</div>
            <div class="eliminar" data-index="${o}">❌</div>
        `,n.appendChild(m),s+=a.precio}),document.getElementById("total-precio").textContent=s.toLocaleString("es-CL"),document.querySelectorAll(".carrito-item .eliminar").forEach(a=>{a.addEventListener("click",o=>{const m=o.target.getAttribute("data-index");d.splice(m,1),localStorage.setItem("carrito",JSON.stringify(d)),b()})})}document.getElementById("vaciar-carrito").addEventListener("click",()=>{d=[],localStorage.setItem("carrito",JSON.stringify(d)),b()});function J(n){d.push(n),localStorage.setItem("carrito",JSON.stringify(d)),b()}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("hamburguer-menu"),s=document.getElementById("close-menu"),r=document.getElementById("hamburguer-menu-list");n.addEventListener("click",function(){r.classList.remove("hidden")}),s.addEventListener("click",function(){r.classList.add("hidden")}),r.addEventListener("click",function(a){a.target===r&&r.classList.add("hidden")})});function Y(){const n=document.getElementById("notificacion-carrito");n.classList.remove("hidden"),n.classList.add("opacity-100"),setTimeout(()=>{n.classList.add("hidden"),n.classList.remove("opacity-100")},2e3)}document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("productos");async function s(){try{const a=await fetch("https://fortniteapi.io/v2/shop?lang=es-419&includeRenderData=false",{headers:{Authorization:"11b1a0cd-5fdf5d92-62c4e04b-7356366c"}});if(!a.ok)throw new Error("Error al obtener los datos de la API");const o=await a.json();r(o.shop)}catch(a){console.error("❌ Error al cargar la API:",a)}}function r(a){n.innerHTML="";let o={};a.forEach(t=>{var L,h,E,c,g,f,y,C,v,$,S,k,B,R,U,w,D,O,P,A,H,M,N,T,z,j,q;let u=t.displayType||"No especificado";const l=((L=t.section)==null?void 0:L.name)||u||"Otros";o[l]||(o[l]=[]);const p=new Date((h=t.offerDates)==null?void 0:h.out),e=new Date;let i="";if(p<=e)i="Este producto está fuera de oferta";else{const x=Math.ceil((p-e)/864e5);x<=2&&(i=`¡Últimas horas! Sale en ${x} día(s)`)}o[l].push({nombre:t.displayName,precio:t.price.finalPrice,imagen:(E=t.displayAssets)!=null&&E.length?t.displayAssets[0].background||t.displayAssets[0].url:(f=(g=(c=t.granted)==null?void 0:c[0])==null?void 0:g.images)==null?void 0:f.icon_background,descripcion:t.displayDescription||t.description||"Sin descripción disponible",grupo:((y=t.series)==null?void 0:y.name)||((C=t.set)==null?void 0:C.name)||"Sin categoría",tipo:u,descuento:((v=t.banner)==null?void 0:v.name)||null,inicio:(($=t.offerDates)==null?void 0:$.in)||null,fin:((S=t.offerDates)==null?void 0:S.out)||null,mensajeSalida:i,partede:((R=(B=(k=t.granted)==null?void 0:k[0])==null?void 0:B.set)==null?void 0:R.partOf)||"",bundle:(D=(w=(U=t.granted)==null?void 0:U[0])==null?void 0:w.images)==null?void 0:D.icon_background,bundle2:(A=(P=(O=t.granted)==null?void 0:O[1])==null?void 0:P.images)==null?void 0:A.icon_background,bundle3:(N=(M=(H=t.granted)==null?void 0:H[2])==null?void 0:M.images)==null?void 0:N.icon_background,bundle4:(j=(z=(T=t.granted)==null?void 0:T[3])==null?void 0:z.images)==null?void 0:j.icon_background,rareza:((q=t.rarity)==null?void 0:q.name)||"Sin rareza"})}),Object.entries(o).sort(([t],[u])=>t==="Pistas de improvisación"?1:u==="Pistas de improvisación"?-1:0).forEach(([t,u])=>{const l=document.createElement("h2");l.textContent=t,l.className="category-title",n.appendChild(l);const p=document.createElement("div");p.className=t==="Pistas de improvisación"?"pistas-container":"product-container",u.slice(0,20).forEach(e=>{const i=document.createElement("div");i.classList.add("product-card"),e.tipo==="bundle"&&i.classList.add("big-product-card");const L=e.rareza,h=e.partede||"",E=h.substr(18);i.innerHTML=`
                  ${e.descuento?`<div class="discount-banner">${e.descuento}</div>`:""}
                  <img src="${e.imagen}" alt="${e.nombre}">
                  
                  <div class="product-info">
                      <h3>${e.nombre}</h3>
                       <p><strong>Rareza:</strong> ${L}</p>
                       <p><strong></strong> ${h}</p>
                      <div class="price">
                          <img src="https://lh3.googleusercontent.com/d/1VGnO_T1S2sH-IqqD8TX6aHyQKD7rEYzH=s220?authuser=0" alt="V-Bucks">
                          <span class="old-price">${e.precio}</span>
                          <span class="new-price">${(e.precio*4.9).toLocaleString("es-CL")} CLP</span>
                      </div>
                  </div>
                  <button class="carrito" data-product="${e.nombre}" data-price="${e.precio}" data-imagen="${e.imagen}" data-fecha="${e.fin}">
                      <img src="https://lh3.googleusercontent.com/d/1G3MVAV9knIYqiLI6cI7gwKob6Vuvo5MC=s220?authuser=0" alt="Añadir al carrito">
                  </button>
                  
              `,i.querySelector(".carrito").addEventListener("click",c=>{c.stopPropagation();const g=c.target.closest("button").dataset.product,f=c.target.closest("button").dataset.price*4.9,y=c.target.closest("button").dataset.imagen;J({nombre:g,precio:f,imagen:y}),Y()}),i.addEventListener("click",c=>{if(!c.target.closest(".carrito")){const g=e.descripcion||"Sin descripción disponible",f=e.fin||"Fecha no disponible";window.location.href=`detalleproducto.html?nombre=${encodeURIComponent(e.nombre)}&precio=${encodeURIComponent(e.precio)}&imagen=${encodeURIComponent(e.imagen)}&partOf=${encodeURIComponent(e.grupo)}&mainType=${encodeURIComponent(e.tipo)}&descripcion=${encodeURIComponent(g)}&fecha=${encodeURIComponent(e.inicio||"Fecha no disponible.")}&out=${encodeURIComponent(f)}&mensajeSalida=${encodeURIComponent(e.mensajeSalida)}&rareza=${encodeURIComponent(e.rareza)}&partede=${encodeURIComponent(E)}&imgbundle=${encodeURIComponent(e.bundle)}&imgbundle2=${encodeURIComponent(e.bundle2)}&imgbundle3=${encodeURIComponent(e.bundle3)}&imgbundle4=${encodeURIComponent(e.bundle4)}
            
            `}}),p.appendChild(i)}),n.appendChild(p)})}s()});function G(){const n=new Date,s={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0};return n.toLocaleString("es-ES",s)}document.getElementById("fecha-actual").textContent=G();document.querySelector("#carrito-popup .total button").addEventListener("click",()=>{window.location.href="checkout.html"});
