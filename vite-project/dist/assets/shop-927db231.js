import"./modulepreload-polyfill-3cfb730f.js";let p=JSON.parse(localStorage.getItem("carrito"))||[];const j=document.getElementById("cart-desktop"),F=document.getElementById("cart-mobile"),v=document.getElementById("carrito-popup"),V=document.getElementById("cerrar-carrito");j.addEventListener("click",()=>{v.classList.add("open"),y()});F.addEventListener("click",()=>{v.classList.add("open"),y()});V.addEventListener("click",()=>{v.classList.remove("open")});function y(){const n=document.getElementById("carrito-contenido");n.innerHTML="",p.length===0&&(n.innerHTML="<p>No hay productos en el carrito.</p>");let i=0;p.forEach((a,c)=>{const r=document.createElement("div");r.classList.add("carrito-item"),r.innerHTML=`
            <img src="${a.imagen}" alt="${a.nombre}">
            <div class="nombre">${a.nombre}</div>
            <div class="precio">${a.precio.toLocaleString("es-CL")} CLP</div>
            <div class="eliminar" data-index="${c}">❌</div>
        `,n.appendChild(r),i+=a.precio}),document.getElementById("total-precio").textContent=i.toLocaleString("es-CL"),document.querySelectorAll(".carrito-item .eliminar").forEach(a=>{a.addEventListener("click",c=>{const r=c.target.getAttribute("data-index");p.splice(r,1),localStorage.setItem("carrito",JSON.stringify(p)),y()})})}document.getElementById("vaciar-carrito").addEventListener("click",()=>{p=[],localStorage.setItem("carrito",JSON.stringify(p)),y()});document.querySelector("#carrito-popup .checkout-btn").addEventListener("click",()=>{window.location.href="/checkout.html"});function _(n){p.push(n),localStorage.setItem("carrito",JSON.stringify(p)),y()}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("hamburguer-menu"),i=document.getElementById("close-menu"),o=document.getElementById("hamburguer-menu-list");n.addEventListener("click",function(){o.classList.remove("hidden")}),i.addEventListener("click",function(){o.classList.add("hidden")}),o.addEventListener("click",function(a){a.target===o&&o.classList.add("hidden")})});function J(){const n=document.getElementById("notificacion-carrito");n.classList.remove("hidden"),n.classList.add("opacity-100"),setTimeout(()=>{n.classList.add("hidden"),n.classList.remove("opacity-100")},2e3)}document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("productos");let i=[];async function o(){try{const c=await fetch("https://fortniteapi.io/v2/shop?lang=es-419&includeRenderData=false",{headers:{Authorization:"11b1a0cd-5fdf5d92-62c4e04b-7356366c"}});if(!c.ok)throw new Error("Error al obtener los datos de la API");i=(await c.json()).shop,a(i)}catch(c){console.error("❌ Error al cargar la API:",c)}}function a(c){n.innerHTML="";let r={};c.forEach(t=>{var L,b,C,m,g,f,E,I,$,S,k,B,w,P,R,U,D,O,q,A,N,z,H,M,T;let s=t.displayType||"No especificado";const d=((L=t.section)==null?void 0:L.name)||s||"Otros";r[d]||(r[d]=[]);const u=new Date((b=t.offerDates)==null?void 0:b.out),e=new Date;let l="";if(u<=e)l="Este producto está fuera de oferta";else{const x=Math.ceil((u-e)/864e5);x<=2&&(l=`¡Últimas horas! Sale en ${x} día(s)`)}r[d].push({nombre:t.displayName,precio:t.price.finalPrice,imagen:(m=(C=t.displayAssets)==null?void 0:C[0])==null?void 0:m.url,descripcion:t.displayDescription||t.description||"Sin descripción disponible",grupo:((g=t.series)==null?void 0:g.name)||((f=t.set)==null?void 0:f.name)||"Sin categoría",tipo:s,descuento:((E=t.banner)==null?void 0:E.name)||null,inicio:((I=t.offerDates)==null?void 0:I.in)||null,fin:(($=t.offerDates)==null?void 0:$.out)||null,mensajeSalida:l,partede:((B=(k=(S=t.granted)==null?void 0:S[0])==null?void 0:k.set)==null?void 0:B.partOf)||"",bundle:(R=(P=(w=t.granted)==null?void 0:w[0])==null?void 0:P.images)==null?void 0:R.icon_background,bundle2:(O=(D=(U=t.granted)==null?void 0:U[1])==null?void 0:D.images)==null?void 0:O.icon_background,bundle3:(N=(A=(q=t.granted)==null?void 0:q[2])==null?void 0:A.images)==null?void 0:N.icon_background,bundle4:(M=(H=(z=t.granted)==null?void 0:z[3])==null?void 0:H.images)==null?void 0:M.icon_background,colorfondo:t.colors.color1,rareza:((T=t.rarity)==null?void 0:T.name)||"Sin rareza"})}),Object.entries(r).sort(([t],[s])=>t==="Pistas de improvisación"?1:s==="Pistas de improvisación"?-1:0).forEach(([t,s])=>{const d=document.createElement("h2");d.textContent=t,d.className="category-title",n.appendChild(d);const u=document.createElement("div");u.className=t==="Pistas de improvisación"?"pistas-container":"product-container",s.slice(0,20).forEach(e=>{const l=document.createElement("div");l.classList.add("product-card"),e.tipo==="bundle"&&l.classList.add("big-product-card");const L=e.rareza,b=e.partede||"",C=b.substr(18);l.innerHTML=`
  ${e.descuento?`<div class="discount-banner">${e.descuento}</div>`:""}
  <div class="product-image" style="background-color: ${e.colorfondo};">
    <img src="${e.imagen}" alt="${e.nombre}">
  </div>
  <div class="product-info">
      <h3>${e.nombre}</h3>
      <p><strong>Rareza:</strong> ${L}</p>
      <p><strong></strong> ${b}</p>
      <div class="price">
          <img src="https://lh3.googleusercontent.com/d/1VGnO_T1S2sH-IqqD8TX6aHyQKD7rEYzH=s220?authuser=0" alt="V-Bucks" style="width: 20px;">
          <span class="old-price">${e.precio}</span>
          <span class="new-price">${(e.precio*4.4).toLocaleString("es-CL")} CLP</span>
      </div>
  </div>
  <button class="carrito" data-product="${e.nombre}" data-price="${e.precio}" data-imagen="${e.imagen}" data-fecha="${e.fin}">
      <img src="https://lh3.googleusercontent.com/d/1G3MVAV9knIYqiLI6cI7gwKob6Vuvo5MC=s220?authuser=0" alt="Añadir al carrito">
  </button>
`,l.querySelector(".carrito").addEventListener("click",m=>{m.stopPropagation();const g=m.target.closest("button").dataset.product,f=m.target.closest("button").dataset.price*4.9,E=m.target.closest("button").dataset.imagen;_({nombre:g,precio:f,imagen:E}),J()}),l.addEventListener("click",m=>{if(!m.target.closest(".carrito")){const g=e.descripcion||"Sin descripción disponible",f=e.fin||"Fecha no disponible";window.location.href=`detalleproducto.html?nombre=${encodeURIComponent(e.nombre)}&precio=${encodeURIComponent(e.precio)}&imagen=${encodeURIComponent(e.imagen)}&partOf=${encodeURIComponent(e.grupo)}&mainType=${encodeURIComponent(e.tipo)}&descripcion=${encodeURIComponent(g)}&fecha=${encodeURIComponent(e.inicio||"Fecha no disponible.")}&out=${encodeURIComponent(f)}&mensajeSalida=${encodeURIComponent(e.mensajeSalida)}&rareza=${encodeURIComponent(e.rareza)}&partede=${encodeURIComponent(C)}&imgbundle=${encodeURIComponent(e.bundle)}&imgbundle2=${encodeURIComponent(e.bundle2)}&imgbundle3=${encodeURIComponent(e.bundle3)}&imgbundle4=${encodeURIComponent(e.bundle4)}
            
            `}}),u.appendChild(l)}),n.appendChild(u)})}o()});function Y(){const n=new Date,i={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0};return n.toLocaleString("es-ES",i)}document.getElementById("fecha-actual").textContent=Y();document.querySelector("#carrito-popup .total button").addEventListener("click",()=>{window.location.href="checkout.html"});document.getElementById("buscador").addEventListener("input",function(){const n=this.value.toLowerCase(),i=document.querySelectorAll(".category-title");if(n===""){restaurarProductos();return}i.forEach(o=>{const a=o.nextElementSibling,c=a.querySelectorAll(".product-card");let r=!1;c.forEach(h=>{const s=h.querySelector("h3").textContent.toLowerCase().includes(n);h.style.display=s?"block":"none",s&&(r=!0)}),r?(o.style.display="block",a.style.display=""):(o.style.display="none",a.style.display="none")})});document.getElementById("buscador").addEventListener("input",function(){const n=this.value.toLowerCase().trim();if(!n){mostrarProductos(allItems);return}const i=allItems.filter(o=>{var t,s,d,u;const a=(o.displayName||"").toLowerCase(),c=(((t=o.rarity)==null?void 0:t.name)||"").toLowerCase(),r=(((s=o.series)==null?void 0:s.name)||((d=o.set)==null?void 0:d.name)||"").toLowerCase(),h=(((u=o.section)==null?void 0:u.name)||"").toLowerCase();return a.includes(n)||c.includes(n)||r.includes(n)||h.includes(n)});mostrarProductos(i)});
